"use strict";

var crypto = require("crypto");

var secret;

function generate(done, fail) {
	crypto.randomBytes(32, function (err, buf) {
		if (err) {
			fail(err);

		} else {
			done(buf.toString("hex"));
		}
	});
}

exports.getSecret = function (done, fail) {
	if (secret) {
		done();

	} else {
		generate(function (hex) {
			secret = hex;

			done();

		}, fail);
	}
};

exports.sha256 = function (input, done, fail) {
	exports.getSecret(function () {
		var hash = crypto.createHmac("sha256", secret);

		hash.update(input);

		done(hash.digest("hex"));

	}, fail);
};
