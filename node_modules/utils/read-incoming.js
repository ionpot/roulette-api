"use strict";

// Read from an IncomingMessage until "max" is exceeded.
// Dump the rest.
module.exports = function (st, max, done) {
	var len = 0;
	var str = "";

	function onEnd() {
		done(str);
	}

	function onData(chunk) {
		len += Buffer.byteLength(chunk);
		str += chunk;

		if (len > max) {
			st.removeListener("data", onData);
			st.removeListener("end", onEnd);
			st._dump();

			onEnd();
		}
	}

	st.on("data", onData);
	st.on("end", onEnd);
};
